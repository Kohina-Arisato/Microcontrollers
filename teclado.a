ORG 00H

MOV TMOD, #00000001B
MOV TH0, #0B1H
MOV TL0, #0E0H

MOV P2, #0FFH
MOV P3, #00H

K1: MOV P1, #0
	MOV A, P2
	SETB P2.7
	ANL A,#00001111B
	CJNE A,#00001111B,K1
	
K2: ACALL DELAY
	MOV A, P2
	ANL A, #00001111B
	CJNE A, #00001111B,OVER
	SJMP K2
	
OVER: ACALL DELAY
	  MOV A, P2
	  ANL A, #00001111B
	  CJNE A, #00001111B,OVER1
	  SJMP K2
	  
OVER1: MOV P1, #11111110B
	   MOV A, P2
	   ANL A, #00001111B
	   CJNE A, #00001111B,ROW_0
	   
	   MOV P1, #11111101B
	   MOV A, P2
	   ANL A, #00001111B
	   CJNE A, #00001111B,ROW_1
	   
	   MOV P1, #11111011B
	   MOV A, P2
	   ANL A, #00001111B
	   CJNE A, #00001111B,ROW_2
	   
	   MOV P1, #11110111B
	   MOV A, P2
	   ANL A, #00001111B
	   CJNE A, #00001111B,ROW_3
	   LJMP K2
	   
ROW_0: MOV DPTR, #KCODE0
	   SJMP FIND

ROW_1: MOV DPTR, #KCODE1
	   SJMP FIND

ROW_2: MOV DPTR, #KCODE2
	   SJMP FIND

ROW_3: MOV DPTR, #KCODE3

FIND: RRC A
	  JNC MATCH
	  INC DPTR
	  SJMP FIND

MATCH: CLR A
	   MOVC A, @A+DPTR
	   MOV P3, A
	   CLR P2.7
	   LJMP K1
	  
ORG 300H

KCODE0: DB	'A','3','2','1'	;ROW 0
KCODE1: DB	'B','6','5','4' ;ROW 1
KCODE2: DB	'C','9','8','7' ;ROW 2
KCODE3: DB	'D','E','0','F' ;ROW 3
	
DELAY: SETB TR0
LOOP: JNB TF0, LOOP
	  CLR TF0
	  CLR TR0
	  MOV TH0, #0B1H
	  MOV TL0, #0E0H
	  RET

END